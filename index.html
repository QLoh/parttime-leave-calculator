<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>部分工時假期計算器</title>
  <style>
    body {
      font-family: "Noto Sans TC", "Microsoft JhengHei", sans-serif;
      background: #f9f9f9;
      color: #333;
      line-height: 1.6;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #222;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      max-width: 700px;
      margin: 20px auto;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .step-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
      color: #444;
    }
    .leave-option {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .leave-option input {
      margin-right: 8px;
    }
    button {
      background: #444;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 10px 16px;
      cursor: pointer;
      margin-top: 15px;
    }
    button:hover {
      background: #666;
    }
    .results {
      line-height: 1.6;
      font-size: 16px;
      margin-top: 15px;
    }
    .formulas {
      margin-top: 15px;
      padding: 12px;
      background: #f3f3f3;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.5;
      color: #444;
    }
    .footer {
      margin-top: 30px;
      font-size: 14px;
      text-align: center;
      color: #666;
      border-top: 1px solid #ddd;
      padding-top: 10px;
    }
  </style>
</head>
<body>
  <h1>部分工時假期計算器</h1>

  <!-- Step 1 -->
  <div id="step1" class="card">
    <div class="step-title">Step 1：選擇要計算的假別</div>
    <div class="leave-option"><input type="checkbox" value="vacation"> 特休假</div>
    <div class="leave-option"><input type="checkbox" value="maternity"> 產假</div>
    <div class="leave-option"><input type="checkbox" value="menstrual"> 生理假</div>
    <div class="leave-option"><input type="checkbox" value="marriage"> 婚假</div>
    <div class="leave-option"><input type="checkbox" value="funeral"> 喪假</div>
    <div class="leave-option"><input type="checkbox" value="sick"> 病假</div>
    <div class="leave-option"><input type="checkbox" value="personal"> 事假</div>
    <button onclick="goStep2()">下一步</button>
    <div class="footer">
      水山子研究室<br>
      Email: sarraaagoole@gmail.com<br>
      使用人次：<span id="counter1">0</span>
    </div>
  </div>

  <!-- Step 2 -->
  <div id="step2" class="card" style="display:none;">
    <div class="step-title">Step 2：輸入必要資訊</div>
    <div id="selected-leaves"></div>
    <h3>共用資訊</h3>
    到職日：<input type="date" id="startDate"><br><br>
    平均月工時（不含加班）：<input type="number" id="monthHours" value="100"><br><br>
    平均週工時：<input type="number" id="weekHours" value="25"><br><br>
    時薪（元）：<input type="number" id="wage" value="200"><br><br>

    <h3>生理假額外資訊</h3>
    當日班表時數：<input type="number" id="menstrualHours" value="8"><br><br>

    <button onclick="goStep1()">上一步</button>
    <button onclick="goStep3()">計算</button>
    <div class="footer">
      水山子研究室<br>
      Email: sarraaagoole@gmail.com<br>
      使用人次：<span id="counter2">0</span>
    </div>
  </div>

  <!-- Step 3 -->
  <div id="step3" class="card" style="display:none;">
    <div class="step-title">Step 3：計算結果</div>
    <div id="results" class="results"></div>
    <div id="formulas" class="formulas"></div>
    <button onclick="goStep2()">上一步</button>
    <button onclick="copyAll()">複製全部</button>
    <div class="footer">
      水山子研究室<br>
      Email: sarraaagoole@gmail.com<br>
      使用人次：<span id="counter3">0</span>
    </div>
  </div>

<script>
let selected = [];
let counter = 0;

function goStep2(){
  selected = [];
  document.querySelectorAll('#step1 input:checked').forEach(cb=>{
    selected.push(cb.value);
  });
  if(selected.length===0){ alert("請至少選擇一個假別！"); return; }
  document.getElementById("selected-leaves").innerText = "已選假別：" + selected.map(c=>translate(c)).join("、");
  document.getElementById("step1").style.display="none";
  document.getElementById("step2").style.display="block";
  document.getElementById("step3").style.display="none";
  incrementCounter(2);
}

function goStep1(){
  document.getElementById("step1").style.display="block";
  document.getElementById("step2").style.display="none";
  document.getElementById("step3").style.display="none";
  incrementCounter(1);
}

function goStep3(){
  const wage = parseFloat(document.getElementById("wage").value)||0;
  const weekHours = parseFloat(document.getElementById("weekHours").value)||0;
  const menstrualHours = parseFloat(document.getElementById("menstrualHours").value)||0;

  let resultsText = "已選假別：" + selected.map(c=>translate(c)).join("、") + "<br><br>";
  let formulaText = "";

  selected.forEach(type=>{
    if(type==="vacation"){
      const hours = 32.18;
      resultsText += `特休假共 7 天，折算 ${hours.toFixed(2)} 小時，應發 NT$${(hours*wage).toLocaleString()}。<br>`;
      formulaText += "‣ 特休假時數 = (實際年工時 ÷ 2088) × 特休天數 × 8<br>";
    }
    if(type==="maternity"){
      const hours = weekHours/40*56*8;
      resultsText += `產假共 56 天，折算 ${hours.toFixed(2)} 小時，應發 NT$${(hours*wage).toLocaleString()}。<br>`;
      formulaText += "‣ 產假工時 = 平均週工時 ÷ 40 × 假期天數 × 8<br>";
    }
    if(type==="menstrual"){
      const hours = menstrualHours;
      resultsText += `生理假 1 天，依班表 ${hours.toFixed(2)} 小時，半薪 NT$${(hours*wage*0.5).toLocaleString()}。<br>`;
      formulaText += "‣ 生理假薪資 = 當日班表時數 × 時薪 × 0.5<br>";
    }
    if(type==="personal"){
      const hours = weekHours/40*112;
      resultsText += `事假 112 小時，折算 ${hours.toFixed(2)} 小時，依法無給薪。<br>`;
      formulaText += "‣ 事假工時 = 平均週工時 ÷ 40 × 112小時<br>";
    }
    if(type==="marriage"){
      const hours = weekHours/40*8*8;
      resultsText += `婚假共 8 天，折算 ${hours.toFixed(2)} 小時，應發 NT$${(hours*wage).toLocaleString()}。<br>`;
      formulaText += "‣ 婚假工時 = 平均週工時 ÷ 40 × 8天 × 8<br>";
    }
    if(type==="funeral"){
      const hours = weekHours/40*8*8;
      resultsText += `喪假共 8 天，折算 ${hours.toFixed(2)} 小時，應發 NT$${(hours*wage).toLocaleString()}。<br>`;
      formulaText += "‣ 喪假工時 = 平均週工時 ÷ 40 × 假期天數 × 8<br>";
    }
    if(type==="sick"){
      const hours = weekHours/40*30*8;
      resultsText += `病假 30 天，折算 ${hours.toFixed(2)} 小時，半薪 NT$${(hours*wage*0.5).toLocaleString()}。<br>`;
      formulaText += "‣ 病假工時 = 平均週工時 ÷ 40 × 30天 × 8 × 0.5<br>";
    }
  });

  document.getElementById("results").innerHTML = resultsText;
  document.getElementById("formulas").innerHTML = "<strong>運算公式：</strong><br>" + formulaText;
  document.getElementById("step1").style.display="none";
  document.getElementById("step2").style.display="none";
  document.getElementById("step3").style.display="block";
  incrementCounter(3);
}

function copyAll(){
  const text = document.getElementById("results").innerText + "\n\n公式：\n" + document.getElementById("formulas").innerText;
  navigator.clipboard.writeText(text).then(()=>{
    alert("已複製到剪貼簿！");
  });
}

function translate(code){
  switch(code){
    case "vacation": return "特休假";
    case "maternity": return "產假";
    case "menstrual": return "生理假";
    case "marriage": return "婚假";
    case "funeral": return "喪假";
    case "sick": return "病假";
    case "personal": return "事假";
  }
}

function incrementCounter(step){
  counter++;
  document.getElementById("counter"+step).innerText = counter;
}
</script>
</body>
</html>
