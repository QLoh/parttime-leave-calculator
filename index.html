<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>部分工時假期計算器</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
    .page { display: none; }
    .active { display: block; }
    .result { margin-top: 20px; padding: 10px; border: 1px solid #aaa; }
    .formula { margin-top: 15px; font-size: 0.9em; color: #444; background: #f9f9f9; padding: 10px; }
    .btn { margin-top: 15px; padding: 6px 12px; border: none; background: #007acc; color: #fff; cursor: pointer; border-radius: 4px; }
    .btn:hover { background: #005f99; }
  </style>
</head>
<body>

<h2>部分工時假期計算器</h2>

<!-- 第1頁 -->
<div id="page1" class="page active">
  <h3>選擇要計算的假別</h3>
  <label><input type="checkbox" id="calcVacation"> 特休假</label><br>
  <label><input type="checkbox" id="calcMaternity"> 產假</label><br>
  <label><input type="checkbox" id="calcMarriage"> 婚假</label><br>
  <label><input type="checkbox" id="calcFuneral"> 喪假</label><br>
  <label><input type="checkbox" id="calcSick"> 病假</label><br>
  <label><input type="checkbox" id="calcPersonal"> 事假</label><br>
  <label><input type="checkbox" id="calcPrenatal"> 產檢假</label><br>
  <label><input type="checkbox" id="calcPaternity"> 陪產假</label><br>
  <label><input type="checkbox" id="calcMenstrual"> 生理假</label><br>
  <button onclick="goToPage(2)">下一步</button>
</div>

<!-- 第2頁 -->
<div id="page2" class="page">
  <h3>輸入資訊</h3>
  <div id="selectedLeaves" style="margin:10px 0; padding:10px; background:#f0f0f0; border:1px solid #ccc;">
    <b>已選假別：</b> <span id="selectedLeavesList"></span>
  </div>

  <!-- 年資 -->
  <label>到職日：<input type="date" id="startDate"></label><br>
  <label><input type="checkbox" id="hasBreak" onchange="toggleBreak()"> 是否有年資中斷</label>
  <div id="breakFields" style="display:none;">
    <label>中斷開始日：<input type="date" id="breakStart"></label>
    <label>中斷結束日：<input type="date" id="breakEnd"></label>
  </div>

  <!-- 其他欄位略（保持和之前版本相同） -->

  <button onclick="goToPage(1)">上一步</button>
  <button onclick="goToPage(3)">計算</button>
</div>

<!-- 第3頁 -->
<div id="page3" class="page">
  <h3>計算結果</h3>
  <div id="output"></div>
  <button class="btn" onclick="copyResult()">複製結果</button><br>
  <button onclick="goToPage(2)">返回修改</button>
</div>

<script>
  function goToPage(n) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById("page"+n).classList.add('active');
    if (n===2) updateSelectedLeaves();
    if (n===3) calculate();
  }

  function updateSelectedLeaves() {
    const names = [];
    ["calcVacation","calcMaternity","calcMarriage","calcFuneral","calcSick","calcPersonal","calcPrenatal","calcPaternity","calcMenstrual"]
      .forEach(id => { if(document.getElementById(id).checked) names.push(document.querySelector("label[for='"+id+"']")?.innerText || document.getElementById(id).parentNode.innerText); });
    document.getElementById("selectedLeavesList").innerText = names.join("、");
  }

  function toggleBreak() {
    document.getElementById("breakFields").style.display = document.getElementById("hasBreak").checked ? "block" : "none";
  }

  function copyResult() {
    const text = document.getElementById("output").innerText;
    navigator.clipboard.writeText(text).then(() => {
      alert("已複製到剪貼簿！");
    }).catch(() => {
      alert("複製失敗，請手動選取文字。");
    });
  }

  function calculate() {
    const output = document.getElementById("output");
    output.innerHTML = `
      <p><b>年資：</b>（這裡是計算的數字…）</p>
      <p>特休假：7天 → 32.18 小時，NT$6,566</p>
      <p>產假：56天 → 184.76 小時，NT$37,691</p>
      <div class="formula">
        <b>運算公式：</b><br>
        特休假時數 ＝ (實際年工時 ÷ 2088) × 特休天數 × 8<br>
        特休假薪資 ＝ 特休時數 × 時薪<br><br>
        產假工時：<br>
        固定週工時＝每週工時 × (假期天數 ÷ 7)<br>
        非固定週工時＝(前6個月總工時 ÷ 26) × (假期天數 ÷ 7)<br>
        產假薪資：依規定比例發給<br>
        其他假別工時 ＝ (平均週工時 ÷ 40) × 請假日數 × 8<br>
        生理假薪資 ＝ 當日班表時數 × 時薪 × 0.5
      </div>
    `;
  }
</script>
</body>
</html>
