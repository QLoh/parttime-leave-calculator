<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>部分工時假期計算器</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
    .page { display: none; }
    .active { display: block; }
    .result { margin-top: 20px; padding: 10px; border: 1px solid #aaa; }
    .formula { margin-top: 15px; font-size: 0.9em; color: #444; background: #f9f9f9; padding: 10px; }
  </style>
</head>
<body>

<h2>部分工時假期計算器</h2>

<!-- 第1頁：選擇假別 -->
<div id="page1" class="page active">
  <h3>選擇要計算的假別</h3>
  <label><input type="checkbox" id="calcVacation"> 特休假</label><br>
  <label><input type="checkbox" id="calcMaternity"> 產假</label><br>
  <label><input type="checkbox" id="calcMarriage"> 婚假</label><br>
  <label><input type="checkbox" id="calcFuneral"> 喪假</label><br>
  <label><input type="checkbox" id="calcSick"> 病假</label><br>
  <label><input type="checkbox" id="calcPersonal"> 事假</label><br>
  <label><input type="checkbox" id="calcPrenatal"> 產檢假</label><br>
  <label><input type="checkbox" id="calcPaternity"> 陪產假</label><br>
  <label><input type="checkbox" id="calcMenstrual"> 生理假</label><br>
  <button onclick="goToPage(2)">下一步</button>
</div>

<!-- 第2頁：輸入資訊 -->
<div id="page2" class="page">
  <h3>輸入資訊</h3>
  <!-- 年資：共用 -->
  <label>到職日：<input type="date" id="startDate"></label><br>
  <label><input type="checkbox" id="hasBreak" onchange="toggleBreak()"> 是否有年資中斷</label>
  <div id="breakFields" style="display:none;">
    <label>中斷開始日：<input type="date" id="breakStart"></label>
    <label>中斷結束日：<input type="date" id="breakEnd"></label>
  </div>

  <!-- 特休需要 -->
  <div id="vacationFields" style="display:none; margin-top:10px;">
    <h4>特休假資訊</h4>
    <label>每月平均工時（不含加班）：<input type="number" id="monthlyHoursVacation"></label><br>
    <label>時薪（元）：<input type="number" id="hourlyWageVacation"></label>
  </div>

  <!-- 產假需要 -->
  <div id="maternityFields" style="display:none; margin-top:10px;">
    <h4>產假資訊</h4>
    <label>是否滿半年？<input type="checkbox" id="overSixMonths" checked></label><br>
    <label>週工時類型：
      <select id="workType" onchange="toggleWorkType()">
        <option value="fixed">固定</option>
        <option value="variable">非固定</option>
      </select>
    </label><br>
    <label>每月工時：<input type="number" id="monthlyHoursMaternity"></label><br>
    <div id="variableInput" style="display:none;">
      <label>前6個月總工時：<input type="number" id="sixMonthHours"></label>
    </div>
    <label>固定週工時（若已知）：<input type="number" id="weeklyHours"></label><br>
    <label>時薪（元）：<input type="number" id="hourlyWageMaternity"></label><br>
    <label>產假類型：
      <select id="maternityType">
        <option value="56">正常分娩（56天，全薪或半薪）</option>
        <option value="28">流產 ≥3個月（28天，半薪）</option>
        <option value="7">流產 2~3個月（7天，不給薪）</option>
        <option value="5">流產 <2個月（5天，不給薪）</option>
      </select>
    </label>
  </div>

  <!-- 其他假別需要 -->
  <div id="otherLeaveFields" style="display:none; margin-top:10px;">
    <h4>其他假別資訊</h4>
    <label>平均週工時：<input type="number" id="weeklyHoursOther"></label><br>
    <label>時薪（元）：<input type="number" id="hourlyWageOther"></label><br>
    <label>生理假當日班表時數：<input type="number" id="menstrualDayHours"></label><br>

    <!-- 喪假親屬關係選單 -->
    <div id="funeralFields" style="display:none; margin-top:10px;">
      <h4>喪假親屬關係</h4>
      <select id="funeralRelation">
        <option value="8">父母、養父母、繼父母、配偶（8日）</option>
        <option value="6">祖父母、子女、配偶父母/養父母/繼父母（6日）</option>
        <option value="3">曾祖父母、兄弟姊妹、配偶祖父母（3日）</option>
      </select>
    </div>
  </div>

  <button onclick="goToPage(1)">上一步</button>
  <button onclick="goToPage(3)">計算</button>
</div>

<!-- 第3頁：結果 -->
<div id="page3" class="page">
  <h3>計算結果</h3>
  <div id="output"></div>
  <button onclick="goToPage(2)">返回修改</button>
</div>

<script>
  function goToPage(n) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById("page"+n).classList.add('active');

    if (n===2) {
      document.getElementById("vacationFields").style.display =
        document.getElementById("calcVacation").checked ? "block" : "none";
      document.getElementById("maternityFields").style.display =
        document.getElementById("calcMaternity").checked ? "block" : "none";

      const otherIds = ["calcMarriage","calcFuneral","calcSick","calcPersonal","calcPrenatal","calcPaternity","calcMenstrual"];
      const showOther = otherIds.some(id => document.getElementById(id).checked);
      document.getElementById("otherLeaveFields").style.display = showOther ? "block" : "none";
      document.getElementById("funeralFields").style.display = document.getElementById("calcFuneral").checked ? "block" : "none";
    }

    if (n===3) { calculate(); }
  }

  function toggleBreak() {
    document.getElementById("breakFields").style.display =
      document.getElementById("hasBreak").checked ? "block" : "none";
  }
  function toggleWorkType() {
    document.getElementById("variableInput").style.display =
      document.getElementById("workType").value === "variable" ? "block" : "none";
  }

  function daysBetween(d1, d2) {
    const ms = new Date(d2.getFullYear(), d2.getMonth(), d2.getDate()) - 
               new Date(d1.getFullYear(), d1.getMonth(), d1.getDate());
    return Math.max(0, Math.ceil(ms / (1000*60*60*24)));
  }
  function monthsFromDays(days) { return Math.floor(days / 30); }
  function calculateVacationDays(monthsWorked) {
    if (monthsWorked < 6) return 0;
    if (monthsWorked < 12) return 3;
    if (monthsWorked < 24) return 7;
    if (monthsWorked < 36) return 10;
    if (monthsWorked < 60) return 14;
    if (monthsWorked < 120) return 15;
    let extra = Math.floor((monthsWorked - 120) / 12) + 16;
    return Math.min(extra, 30);
  }
  function formatCurrency(num) {
    return "NT$" + num.toLocaleString("en-US");
  }

  function calculate() {
    const output = document.getElementById("output");
    output.innerHTML = "";

    const startDate = new Date(document.getElementById("startDate").value);
    const today = new Date();
    let serviceDays = daysBetween(startDate, today);
    if (document.getElementById("hasBreak").checked) {
      const breakStart = new Date(document.getElementById("breakStart").value);
      const breakEnd   = new Date(document.getElementById("breakEnd").value);
      const breakDays  = daysBetween(breakStart, breakEnd);
      serviceDays = Math.max(0, serviceDays - breakDays);
    }
    const monthsWorked = monthsFromDays(serviceDays);
    output.innerHTML += `<p><b>年資：</b>${monthsWorked} 個月</p>`;

    const weeklyHoursOther = parseFloat(document.getElementById("weeklyHoursOther").value) || 0;
    const hourlyWageOther  = parseFloat(document.getElementById("hourlyWageOther").value) || 0;

    // 特休
    if (document.getElementById("calcVacation").checked) {
      const monthlyHours = parseFloat(document.getElementById("monthlyHoursVacation").value);
      const hourlyWage   = parseFloat(document.getElementById("hourlyWageVacation").value);
      const fullYearHours = 2088;
      const yearHours = monthlyHours * 12;
      const vacationDays = calculateVacationDays(monthsWorked);
      const vacationHours = (yearHours / fullYearHours) * vacationDays * 8;
      const vacationPay   = Math.ceil(vacationHours * hourlyWage);
      output.innerHTML += `<p><b>特休假：</b>${vacationDays} 天 → ${vacationHours.toFixed(2)} 小時，${formatCurrency(vacationPay)}</p>`;
    }

    // 產假
    if (document.getElementById("calcMaternity").checked) {
      const overSixMonths = document.getElementById("overSixMonths").checked;
      const workType      = document.getElementById("workType").value;
      const monthlyHours  = parseFloat(document.getElementById("monthlyHoursMaternity").value);
      const weeklyInput   = parseFloat(document.getElementById("weeklyHours").value);
      const hourlyWage    = parseFloat(document.getElementById("hourlyWageMaternity").value);
      const maternityDays = parseInt(document.getElementById("maternityType").value);

      let weeklyHours = 0;
      if (workType === "fixed") {
        weeklyHours = (!isNaN(weeklyInput) && weeklyInput>0) ? weeklyInput : (monthlyHours / 4);
      } else {
        const sixMonthHours = parseFloat(document.getElementById("sixMonthHours").value);
        weeklyHours = sixMonthHours / 26;
      }

      const maternityWeeks = maternityDays / 7;
      const maternityHours = weeklyHours * maternityWeeks;
      let maternityPay = 0;
      if (maternityDays === 56) {
        maternityPay = maternityHours * hourlyWage * (overSixMonths ? 1 : 0.5);
      } else if (maternityDays === 28) {
        maternityPay = maternityHours * hourlyWage * 0.5;
      }
      maternityPay = Math.ceil(maternityPay);
      output.innerHTML += `<p><b>產假：</b>${maternityDays} 天 → ${maternityHours.toFixed(2)} 小時，${maternityPay===0 ? "NT$0（依法無給薪）" : formatCurrency(maternityPay)}</p>`;
    }

    // 婚假
    if (document.getElementById("calcMarriage").checked) {
      const hours = (weeklyHoursOther/40)*8*8;
      const pay = Math.ceil(hours*hourlyWageOther);
      output.innerHTML += `<p><b>婚假：</b>8 日 → ${hours.toFixed(2)} 小時，${formatCurrency(pay)}</p>`;
    }

    // 喪假（依親屬選項）
    if (document.getElementById("calcFuneral").checked) {
      const days = parseInt(document.getElementById("funeralRelation").value);
      const hours = (weeklyHoursOther/40) * days * 8;
      const pay = Math.ceil(hours * hourlyWageOther);
      output.innerHTML += `<p><b>喪假：</b>${days} 日 → ${hours.toFixed(2)} 小時，${formatCurrency(pay)}（全薪）</p>`;
    }

    // 病假
    if (document.getElementById("calcSick").checked) {
      const days = 30;
      const hours = (weeklyHoursOther/40)*days*8;
      const pay = Math.ceil(hours*hourlyWageOther*0.5);
      output.innerHTML += `<p><b>病假：</b>${days} 日 → ${hours.toFixed(2)} 小時，${formatCurrency(pay)}（半薪，未住院30日內）</p>`;
    }

    // 事假
    if (document.getElementById("calcPersonal").checked) {
      const hours = 112;
      output.innerHTML += `<p><b>事假：</b>112 小時，NT$0（依法無給薪）</p>`;
    }

    // 產檢假
    if (document.getElementById("calcPrenatal").checked) {
      const days = 7;
      const hours = (weeklyHoursOther/40)*days*8;
      const pay = Math.ceil(hours*hourlyWageOther);
      output.innerHTML += `<p><b>產檢假：</b>${days} 日 → ${hours.toFixed(2)} 小時，${formatCurrency(pay)}（全薪）</p>`;
    }

    // 陪產假
    if (document.getElementById("calcPaternity").checked) {
      const days = 7;
      const hours = (weeklyHoursOther/40)*days*8;
      const pay = Math.ceil(hours*hourlyWageOther);
      output.innerHTML += `<p><b>陪產假：</b>${days} 日 → ${hours.toFixed(2)} 小時，${formatCurrency(pay)}（全薪）</p>`;
    }

    // 生理假
    if (document.getElementById("calcMenstrual").checked) {
      const hours = parseFloat(document.getElementById("menstrualDayHours").value);
      const pay = Math.ceil(hours*hourlyWageOther*0.5);
      output.innerHTML += `<p><b>生理假：</b>1 日 → ${hours.toFixed(2)} 小時，${formatCurrency(pay)}（半薪）</p>`;
    }
  }
</script>
</body>
</html>
